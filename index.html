<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mandelbrot</title>
  <script src="mandelbrot.js"></script>
</head>
<body>
  <canvas id="canvas" width="1280" height="720"></canvas>
  <script>
      const N = 8;  // Parallel chunks to render (must be a multiple of height)
      const canvas = document.getElementById('canvas');

      window.addEventListener('load', function(e) {
          if (!window.Worker) {
              window.alert('Sorry! This browser does not support web workers');
              return;
          }

          draw();
      });

      function draw() {
          const ctx = canvas.getContext('2d');

          ctx.font = '12px sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText('Rendering fractal...', canvas.width / 2, canvas.height / 2);

          const chunkWidth = canvas.width;
          const chunkHeight = canvas.height / N;
          for (let i = 0; i < 1; i++) {
              for (let j = 0; j < N; j++) {
                  const y = j * chunkHeight;

                  const options = {
                      scale: 300,
                      offsetX: 2 / 3 * canvas.width,
                      offsetY: canvas.height / 2 - y,
                  };

                  drawMandelbrot(ctx, chunkWidth, chunkHeight, options, function (imageData) {
                      // Draw completed fractal
                      ctx.putImageData(imageData, 0, y);
                  });
              }
          }
      }

      function drawMandelbrot(ctx, width, height, options, cb) {
          const worker = new Worker('mandelbrot.js');
          worker.onmessage = function(e) {
              cb(e.data);
          };

          // Start rendering
          worker.postMessage([width, height, options]);
      }
  </script>
</body>
</html>
